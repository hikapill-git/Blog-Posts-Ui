trigger:
  - main  # This triggers the pipeline whenever you push to the 'main' branch

pool:
  vmImage: 'ubuntu-latest' # The Virtual Machine to run the code on (windows-latest also available)

stages:
# ----------------------
# STAGE 1: BUILD (CI)
# ----------------------
- stage: Build
  displayName: 'Build Stage'
  jobs:
  - job: BuildJob
    steps:
    # 1. Checkout code (happens automatically)
    
    # 2. Add your build tasks here based on your language. 
    # Example for Node.js:
    # - script: npm install
    # - script: npm run build
    
    # Example for .NET:
    # - task: DotNetCoreCLI@2
    #   inputs:
    #     command: 'build'
    
    # 3. Publish the build artifacts (So the Deploy stage can use them)
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(System.DefaultWorkingDirectory)' # Or specific dist/bin folder
        ArtifactName: 'drop'
        publishLocation: 'Container'

# ----------------------
# STAGE 2: DEPLOY (CD)
# ----------------------
- stage: Deploy
  displayName: 'Deploy Stage'
  dependsOn: Build
  condition: succeeded()
  jobs:
  - deployment: DeployJob
    environment: 'production'
    strategy:
      runOnce:
        deploy:
          steps:
          # --------------------------------------------------------
          # FIX: We added this script so "steps" is not empty.
          # --------------------------------------------------------
          - script: |
              echo "This is a placeholder for the deploy step."
              echo "The pipeline is working!"
            displayName: 'Run Dummy Deploy'

          # When you are ready for the real deployment, remove the script above 
          # and uncomment the task below (make sure indentation matches):
          
          # - task: AzureWebApp@1
          #   inputs:
          #     azureSubscription: 'Azure-Subscription-Connection'
          #     appType: 'webAppLinux'
          #     appName: 'your-app-name'
          #     package: '$(Pipeline.Workspace)/drop/**/*.zip'